{% extends "base.html" %}

{% block content %}
<div class="controls">
    <h3>Data Management</h3>

    <div>
        <strong>Export Data:</strong>
        <a href="{{ url_for('export_file', format_type='csv') }}" class="btn">Download CSV</a>
        <a href="{{ url_for('export_file', format_type='excel') }}" class="btn">Download Excel</a>
    </div>

    <div style="margin-top: 15px;">
        <strong>Import Data:</strong>
        <form action="{{ url_for('import_file') }}" method="post" enctype="multipart/form-data"
            style="margin-top: 5px;">
            <div style="margin-bottom: 10px;">
                <label for="table_select">Import Target:</label>
                <select name="table_name" id="table_select" style="padding: 5px; margin-right: 10px;">
                    <option value="auto">Auto-detect (Filename)</option>
                    {% if tables %}
                    {% for table in tables %}
                    <option value="{{ table.table_name }}">{{ table.display_name }}</option>
                    {% endfor %}
                    {% endif %}
                </select>
            </div>
            <div>
                <input type="file" name="files" accept=".csv, .txt, .zip" multiple required>
                <button type="submit" class="btn btn-primary" style="background-color: #6f42c1;">Upload Files</button>
            </div>
        </form>
        <div style="margin-top:10px; color: #666; font-size: 0.9em;">
            <p style="margin: 2px 0;"><strong>Note:</strong> You can upload multiple files (.csv, .txt) or a single .zip
                file containing data files. Use "Auto-detect" to match files by filename.</p>
        </div>
    </div>
</div>

<h3>Current Data Stocks</h3>
{% if data %}
<table>
    <thead>
        <tr>
            {% for key in data[0].keys() %}
            <th>{{ key }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for row in data %}
        <tr>
            {% for value in row.values() %}
            <td>{% if value is number %}{{ value|int }}{% else %}{{ value }}{% endif %}</td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No data found.</p>
{% endif %}

{% endblock %}